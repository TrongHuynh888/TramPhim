<!doctype html>
<html lang="vi" data-theme="dark">
  <head>
    <link rel="stylesheet" href="css/upgrade.css" />
    <link rel="stylesheet" href="css/watch-party.css" />
    <link rel="stylesheet" href="css/variables.css" />
    <link rel="stylesheet" href="css/base.css" />
    <link rel="stylesheet" href="css/components.css" />
    <link rel="stylesheet" href="css/layout.css" />
    <link rel="stylesheet" href="css/admin.css" />
    <link rel="stylesheet" href="css/responsive.css?v=106" />
    <!--<link rel="stylesheet" href="css/style.css" />-->
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="R·∫°p Chi·∫øu Phim Blockchain - Xem phim tr·ª±c tuy·∫øn, thanh to√°n b·∫±ng CRO Token"
    />
    <meta
      name="keywords"
      content="blockchain, movie, streaming, CRO, crypto, NFT"
    />

    <title>MovieChain - R·∫°p Chi·∫øu Phim Blockchain</title>

    <!-- Favicon -->
    <link
      rel="icon"
      href="https://public-frontend-cos.metadl.com/mgx/img/favicon_atoms.ico"
      type="image/x-icon"
    />

    <!-- Montserrat Font -->
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&display=swap"
      rel="stylesheet"
    />

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700&family=Rajdhani:wght@400;500;600;700&family=Roboto:wght@300;400;500;700&display=swap"
      rel="stylesheet"
    />

    <!-- Font Awesome Icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <!-- Custom CSS -->
  </head>
  <body>
    <!-- ============================================
         NAVIGATION BAR
         ============================================ -->
    <nav class="navbar" id="navbar">
      <div class="nav-container">
        <button
          id="sidebarToggleBtn"
          class="btn-icon"
          onclick="toggleSidebar()"
          style="
            display: none;
            margin-right: 15px;
            background: transparent;
            border: none;
            color: var(--text-primary);
            cursor: pointer;
          "
        >
          <i class="fas fa-bars" style="font-size: 24px"></i>
        </button>

        <!-- Logo -->
        <a href="#" class="nav-logo" onclick="showPage('home')">
          <i class="fas fa-film"></i>
          <span>MovieChain</span>
        </a>

        <!-- Navigation Menu -->
        <div class="nav-menu" id="navMenu">
          <a
            href="#"
            class="nav-link active"
            data-page="home"
            onclick="showPage('home')"
          >
            <i class="fas fa-home"></i> Trang Ch·ªß
          </a>

          <a
            href="#"
            class="nav-link"
            data-page="movies"
            onclick="showPage('movies')"
          >
            <i class="fas fa-film"></i> T·∫•t c·∫£ Phim
          </a>

          <a href="#" class="nav-link" onclick="filterByMovieType('single')">
            <i class="fas fa-video"></i> Phim L·∫ª
          </a>
          <a href="#" class="nav-link" onclick="filterByMovieType('series')">
            <i class="fas fa-layer-group"></i> Phim B·ªô
          </a>
          <a
            href="#"
            class="nav-link"
            data-page="categories"
            onclick="showPage('categories')"
          >
            <i class="fas fa-tags"></i> Th·ªÉ Lo·∫°i
          </a>
          <!-- Admin Link - Ch·ªâ hi·ªán khi l√† Admin -->
          <a
            href="#"
            class="nav-link hidden"
            id="adminNavLink"
            data-page="admin"
            onclick="showPage('admin')"
          >
            <i class="fas fa-cog"></i> Admin
          </a>
        </div>

        <!-- Navigation Actions -->
        <div class="nav-actions">
          <!-- Theme Toggle -->
          <button
            class="theme-toggle"
            id="themeToggle"
            onclick="toggleTheme()"
            title="ƒê·ªïi giao di·ªán"
          >
            <i class="fas fa-moon" id="themeIcon"></i>
          </button>

          <!-- Wallet Button -->
          <button
            class="btn wallet-btn"
            id="walletBtn"
            onclick="connectWallet()"
          >
            <i class="fas fa-wallet"></i>
            <span>K·∫øt n·ªëi v√≠</span>
          </button>

          <!-- Auth Button -->
          <div id="authContainer" style="position: relative">
            <button
              class="btn btn-primary"
              id="loginBtn"
              onclick="openAuthModal()"
            >
              <i class="fas fa-user"></i> <span>ƒêƒÉng nh·∫≠p</span>
            </button>

            <div
              id="userMenuTrigger"
              class="hidden"
              onclick="toggleUserDropdown(event)"
              style="cursor: pointer"
            >
              <img id="userAvatarSmall" src="" class="nav-user-avatar" />
            </div>

            <div id="userDropdown" class="user-dropdown">
              <div class="dropdown-header">
                <img id="dropdownAvatar" src="" alt="Avatar" />
                <div class="dropdown-user-info">
                  <span class="dropdown-role">Free</span>
                  <strong id="dropdownName">T√™n User</strong>
                </div>
              </div>

              <div class="dropdown-upgrade">
                <p>
                  N√¢ng c·∫•p t√†i kho·∫£n MoiveChain ƒë·ªÉ c√≥ tr·∫£i nghi·ªám ƒë·∫≥ng c·∫•p h∆°n.
                </p>
                <button class="btn-upgrade" onclick="showPage('upgrade')">
                  N√¢ng c·∫•p ngay <i class="fas fa-arrow-up"></i>
                </button>
              </div>

              <ul class="dropdown-list">
                <li class="dropdown-item">
                  <i class="fas fa-wallet"></i>
                  <span>S·ªë d∆∞</span>
                  <span class="balance-badge">0 C</span>
                  <button class="btn-deposit" onclick="showPage('upgrade')">
                    + N·∫°p
                  </button>
                </li>
                <li
                  class="dropdown-item"
                  onclick="openLibraryModal('favorites')"
                >
                  <i class="fas fa-heart"></i> Y√™u th√≠ch
                </li>
                <li class="dropdown-item" onclick="openLibraryModal('history')">
                  <i class="fas fa-history"></i> Xem ti·∫øp
                </li>
                <li class="dropdown-item" onclick="openProfileModal()">
                  <i class="fas fa-user-cog"></i> T√†i kho·∫£n
                </li>
                <li class="dropdown-item logout" onclick="handleLogout()">
                  <i class="fas fa-sign-out-alt"></i> Tho√°t
                </li>
              </ul>
            </div>
          </div>

          <!-- Mobile Menu Toggle -->
          <button
            class="mobile-menu-toggle"
            id="mobileMenuToggle"
            onclick="toggleMobileMenu()"
          >
            <i class="fas fa-bars"></i>
          </button>
        </div>
      </div>
    </nav>

    <!-- ============================================
         MAIN CONTENT
         ============================================ -->
    <main id="mainContent">
      <!-- HOME PAGE -->
      <div id="homePage" class="page active">
        <!-- Hero Section -->
        <section class="hero">
          <div class="hero-content">
            <h1 class="hero-title">
              Ch√†o m·ª´ng ƒë·∫øn v·ªõi <span>MovieChain</span>
            </h1>
            <p class="hero-subtitle">
              Tr·∫£i nghi·ªám xem phim th·∫ø h·ªá m·ªõi v·ªõi c√¥ng ngh·ªá Blockchain. Thanh
              to√°n nhanh ch√≥ng, an to√†n b·∫±ng CRO Token tr√™n m·∫°ng Cronos.
            </p>
            <div class="hero-actions">
              <button
                class="btn btn-primary btn-lg"
                onclick="showPage('movies')"
              >
                <i class="fas fa-play"></i> Kh√°m Ph√° Ngay
              </button>
              <button class="btn btn-neon btn-lg" onclick="connectWallet()">
                <i class="fas fa-wallet"></i> K·∫øt N·ªëi V√≠
              </button>
            </div>
          </div>
        </section>

        <!-- Featured Movies Section -->
        <section class="section">
          <div class="section-header">
            <h2 class="section-title">Phim N·ªïi B·∫≠t</h2>
            <a href="#" class="btn btn-secondary" onclick="showPage('movies')">
              Xem t·∫•t c·∫£ <i class="fas fa-arrow-right"></i>
            </a>
          </div>
          <div class="movie-grid" id="featuredMovies">
            <!-- Movies s·∫Ω ƒë∆∞·ª£c load t·ª´ Firestore -->
            <div class="skeleton" style="height: 350px"></div>
            <div class="skeleton" style="height: 350px"></div>
            <div class="skeleton" style="height: 350px"></div>
            <div class="skeleton" style="height: 350px"></div>
          </div>
        </section>

        <!-- New Movies Section -->
        <section class="section">
          <div class="section-header">
            <h2 class="section-title">Phim M·ªõi C·∫≠p Nh·∫≠t</h2>
          </div>
          <div class="movie-grid" id="newMovies">
            <!-- Movies s·∫Ω ƒë∆∞·ª£c load t·ª´ Firestore -->
          </div>
        </section>
      </div>

      <!-- MOVIES PAGE -->
      <div id="moviesPage" class="page">
        <section class="section">
          <div class="section-header">
            <h2 class="section-title">T·∫•t C·∫£ Phim</h2>
            <div class="search-filter">
              <div class="search-box">
                <i class="fas fa-search"></i>
                <input
                  type="text"
                  class="form-input"
                  id="searchMovies"
                  placeholder="T√¨m ki·∫øm phim..."
                  oninput="searchMovies()"
                />
              </div>
              <select
                class="form-select"
                id="filterCategory"
                onchange="filterMovies()"
              >
                <option value="">T·∫•t c·∫£ th·ªÉ lo·∫°i</option>
              </select>
              <select
                class="form-select"
                id="filterCountry"
                onchange="filterMovies()"
              >
                <option value="">T·∫•t c·∫£ qu·ªëc gia</option>
              </select>
              <select
                class="form-select"
                id="filterYear"
                onchange="filterMovies()"
              >
                <option value="">T·∫•t c·∫£ nƒÉm</option>
              </select>
            </div>
          </div>
          <div class="movie-grid" id="allMovies">
            <!-- Movies s·∫Ω ƒë∆∞·ª£c load t·ª´ Firestore -->
          </div>
        </section>
      </div>

      <!-- CATEGORIES PAGE -->
      <div id="categoriesPage" class="page">
        <section class="section">
          <div class="section-header">
            <h2 class="section-title">Th·ªÉ Lo·∫°i Phim</h2>
          </div>
          <div
            class="movie-grid"
            id="categoriesList"
            style="grid-template-columns: repeat(auto-fill, minmax(250px, 1fr))"
          >
            <!-- Categories s·∫Ω ƒë∆∞·ª£c load t·ª´ Firestore -->
          </div>
        </section>
      </div>

      <!-- MOVIE DETAIL PAGE -->
      <div id="movieDetailPage" class="page">
        <div class="movie-detail">
          <div class="movie-detail-header">
            <div class="movie-poster">
              <img id="detailPoster" src="" alt="Movie Poster" />
            </div>
            <div class="movie-info">
              <h1 id="detailTitle">T√™n Phim</h1>
              <div class="movie-meta">
                <span class="movie-meta-item">
                  <i class="fas fa-calendar"></i>
                  <span id="detailYear">2024</span>
                </span>
                <span class="movie-meta-item">
                  <i class="fas fa-globe"></i>
                  <span id="detailCountry">Vi·ªát Nam</span>
                </span>
                <span class="movie-meta-item">
                  <i class="fas fa-tags"></i>
                  <span id="detailCategory">H√†nh ƒë·ªông</span>
                </span>
                <span class="movie-meta-item">
                  <i class="fas fa-eye"></i>
                  <span id="detailViews">0</span> l∆∞·ª£t xem
                </span>
                <span class="movie-meta-item card-rating">
                  <i class="fas fa-star"></i>
                  <span id="detailRating">0</span>/10
                </span>
              </div>
              <div class="card-tags" id="detailTags">
                <!-- Tags s·∫Ω ƒë∆∞·ª£c th√™m ƒë·ªông -->
              </div>
              <p class="movie-description" id="detailDescription">
                M√¥ t·∫£ phim...
              </p>
              <div class="movie-actions">
                <div class="card-price" style="font-size: 24px">
                  <i class="fas fa-coins"></i>
                  <span id="detailPrice">0</span> CRO
                </div>
                <button
                  class="btn btn-primary btn-lg"
                  id="buyTicketBtn"
                  onclick="buyTicket()"
                >
                  <i class="fas fa-ticket-alt"></i> Mua V√© Ngay
                </button>
              </div>
            </div>
          </div>

          <!-- Video Player -->
          <div class="video-container" id="videoContainer">
            <div class="video-locked" id="videoLocked">
              <i class="fas fa-lock"></i>
              <h3>Video ƒê√£ B·ªã Kh√≥a</h3>
              <p>
                Vui l√≤ng mua v√© ƒë·ªÉ m·ªü kh√≥a v√† xem phim. Thanh to√°n nhanh ch√≥ng,
                an to√†n b·∫±ng CRO Token.
              </p>
              <button class="btn btn-primary btn-lg" onclick="buyTicket()">
                <i class="fas fa-unlock"></i> M·ªü Kh√≥a Ngay
              </button>
            </div>
            <iframe
              id="videoPlayer"
              class="hidden"
              src=""
              allowfullscreen
            ></iframe>
          </div>

          <!-- Episodes Section -->
          <div class="episodes-section" id="episodesSection">
            <h3 class="section-title">Danh S√°ch T·∫≠p</h3>
            <div class="episodes-list" id="episodesList">
              <!-- Episodes s·∫Ω ƒë∆∞·ª£c load ƒë·ªông -->
            </div>
          </div>

          <!-- Comments Section -->
          <div class="comments-section">
            <h3 class="section-title">B√¨nh Lu·∫≠n & ƒê√°nh Gi√°</h3>

            <!-- Comment Form -->
            <div class="comment-form" id="commentForm">
              <div class="rating-input">
                <label>ƒê√°nh gi√° c·ªßa b·∫°n:</label>
                <div class="rating-stars" id="ratingStars">
                  <!-- Stars s·∫Ω ƒë∆∞·ª£c t·∫°o b·∫±ng JS -->
                </div>
                <span class="rating-value" id="ratingValue">0/10</span>
              </div>
              <div class="form-group">
                <textarea
                  class="form-textarea"
                  id="commentContent"
                  placeholder="Vi·∫øt b√¨nh lu·∫≠n c·ªßa b·∫°n..."
                ></textarea>
              </div>
              <button class="btn btn-primary" onclick="submitComment()">
                <i class="fas fa-paper-plane"></i> G·ª≠i B√¨nh Lu·∫≠n
              </button>
            </div>

            <!-- Comments List -->
            <div class="comments-list" id="commentsList">
              <!-- Comments s·∫Ω ƒë∆∞·ª£c load t·ª´ Firestore -->
            </div>
          </div>
        </div>
      </div>
      <div id="modals-container"></div>
      <div id="admin-container"></div>
    </main>

    <!-- ============================================
         FOOTER
         ============================================ -->
    <footer class="footer" id="footer">
      <div class="footer-content">
        <div class="footer-section">
          <h4><i class="fas fa-film"></i> MovieChain</h4>
          <p class="text-muted">
            N·ªÅn t·∫£ng xem phim Blockchain. Thanh to√°n an to√†n, minh b·∫°ch b·∫±ng
            CRO.
          </p>
          <div class="social-links">
            <a href="#"><i class="fab fa-facebook-f"></i></a>
            <a href="#"><i class="fab fa-telegram-plane"></i></a>
            <a href="#"><i class="fab fa-discord"></i></a>
          </div>
        </div>

        <div class="footer-section">
          <h4>Kh√°m Ph√°</h4>
          <ul>
            <li><a href="#" onclick="showPage('movies')">Kho Phim</a></li>
            <li><a href="#" onclick="showPage('categories')">Th·ªÉ Lo·∫°i</a></li>
            <li><a href="#" onclick="showPage('upgrade')">G√≥i VIP</a></li>
          </ul>
        </div>

        <div class="footer-section">
          <h4>H·ªó Tr·ª£</h4>
          <ul>
            <li><a href="#">ƒêi·ªÅu kho·∫£n</a></li>
            <li><a href="#">B·∫£o m·∫≠t</a></li>
            <li><a href="#">Li√™n h·ªá Admin</a></li>
          </ul>
        </div>

        <div class="footer-section stats-box">
          <h4><i class="fas fa-chart-line"></i> Th·ªëng K√™</h4>

          <div class="live-stat-item">
            <span class="stat-label"
              ><i class="fas fa-users"></i> ƒêang Online:</span
            >
            <span class="stat-value highlight" id="statOnline">--</span>
          </div>

          <div class="live-stat-item">
            <span class="stat-label"
              ><i class="fas fa-globe"></i> T·ªïng truy c·∫≠p:</span
            >
            <span class="stat-value" id="statVisits">--</span>
          </div>

          <div class="live-stat-item">
            <span class="stat-label"
              ><i class="fas fa-clock"></i> TG trung b√¨nh:</span
            >
            <span class="stat-value" id="statTime">--</span>
          </div>
        </div>
      </div>

      <div class="footer-bottom">
        <p>&copy; 2026 MovieChain. Powered by Blockchain Technology.</p>
      </div>
    </footer>
    <div id="modals-container"></div>

    <!-- PeerJS for WebRTC -->
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <!-- ============================================
         SCRIPTS

         
         ============================================ -->
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <!-- Ethers.js for Web3 -->
    <script src="https://cdn.ethers.io/lib/ethers-5.7.2.umd.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
    <!-- Firebase Config -->
    <script src="js/firebase-config.js"></script>
    <script src="js/web3-config.js"></script>

    <script src="js/globals.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/data.js"></script>

    <script src="js/auth.js"></script>
    <script src="js/user.js"></script>
    <script src="js/home.js"></script>
    <script src="js/detail.js"></script>
    <script src="js/admin.js"></script>

    <script src="js/upgrade.js"></script>
    <script src="js/watch-party.js"></script>

    <script src="js/main.js"></script>
    <script src="js/loader.js"></script>

    <script>
      // Bu·ªôc tr√¨nh duy·ªát ph·∫£i d√πng h√†m n√†y (Ghi ƒë√® m·ªçi h√†m c≈© b·ªã l·ªói)
      window.showAdminPanel = function (panelName) {
        console.log("üñ±Ô∏è ƒêang chuy·ªÉn sang tab:", panelName);

        // 1. ·∫®n t·∫•t c·∫£ c√°c trang con
        var allPanels = document.querySelectorAll(".admin-panel");
        allPanels.forEach(function (panel) {
          panel.classList.remove("active");
        });

        // 2. Hi·ªán trang c·∫ßn ch·ªçn
        var targetId = panelName + "Panel"; // V√≠ d·ª•: dashboardPanel
        var targetPanel = document.getElementById(targetId);

        if (targetPanel) {
          targetPanel.classList.add("active");
        } else {
          console.error("‚ùå Kh√¥ng t√¨m th·∫•y trang c√≥ ID l√†: " + targetId);
          // N·∫øu kh√¥ng t√¨m th·∫•y panel, th·ª≠ hi·ªán th√¥ng b√°o ƒë·ªÉ ki·ªÉm tra
          // alert("L·ªói: Kh√¥ng t√¨m th·∫•y giao di·ªán " + panelName);
        }

        // 3. ƒê·ªïi m√†u menu b√™n tr√°i (Active)
        var allNavItems = document.querySelectorAll(".admin-nav-item");
        allNavItems.forEach(function (item) {
          item.classList.remove("active");
          // Ki·ªÉm tra xem n√∫t n√†y c√≥ ph·∫£i l√† n√∫t v·ª´a b·∫•m kh√¥ng
          if (
            item.getAttribute("onclick") &&
            item.getAttribute("onclick").includes(panelName)
          ) {
            item.classList.add("active");
          }
        });
      };
    </script>
    <script>
      // H√†m load file HTML b√™n ngo√†i v√†o trang ch√≠nh
      async function loadUpgradePage() {
        try {
          // T·∫£i file upgrade.html
          const response = await fetch("./components/upgrade.html");
          const html = await response.text();

          // Ch√®n v√†o cu·ªëi th·∫ª <main>
          document
            .getElementById("mainContent")
            .insertAdjacentHTML("beforeend", html);
          console.log("‚úÖ ƒê√£ t·∫£i giao di·ªán Upgrade th√†nh c√¥ng!");
        } catch (error) {
          console.error("L·ªói t·∫£i trang Upgrade:", error);
        }
      }

      // G·ªçi h√†m ch·∫°y ngay khi web m·ªü
      loadUpgradePage();
    </script>
  </body>
</html>
