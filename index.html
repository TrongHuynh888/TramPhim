<!doctype html>
<html lang="vi" data-theme="dark">
  <head>
    <link rel="stylesheet" href="css/upgrade.css" />
    <link rel="stylesheet" href="css/watch-party.css" />
    <link rel="stylesheet" href="css/variables.css" />
    <link rel="stylesheet" href="css/base.css" />
    <link rel="stylesheet" href="css/components.css?v=11" />
    <link rel="stylesheet" href="css/layout.css" />
    <link rel="stylesheet" href="css/admin.css" />
    <link rel="stylesheet" href="css/responsive.css?v=152" />
    <link rel="stylesheet" href="css/detail-redesign.css" />
    <link rel="stylesheet" href="css/intro.css" />
    <!--<link rel="stylesheet" href="css/style.css" />-->
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="R·∫°p Chi·∫øu Phim Blockchain - Xem phim tr·ª±c tuy·∫øn, thanh to√°n b·∫±ng CRO Token"
    />
    <meta
      name="keywords"
      content="blockchain, movie, streaming, CRO, crypto, NFT"
    />

    <title>Tr·∫°m Phim - R·∫°p Chi·∫øu Phim Blockchain</title>
    
    <!-- Open Graph Meta Tags cho t√≠nh nƒÉng Chia S·∫ª (Share Link) -->
    <meta property="og:site_name" content="Tr·∫°m Phim" />
    <meta property="og:type" content="website" />
    <meta property="og:title" id="ogTitle" content="Tr·∫°m Phim - R·∫°p Chi·∫øu Phim Blockchain" />
    <meta property="og:description" id="ogDescription" content="R·∫°p Chi·∫øu Phim Blockchain - Xem phim tr·ª±c tuy·∫øn, thanh to√°n b·∫±ng CRO Token" />
    <meta property="og:image" id="ogImage" content="https://public-frontend-cos.metadl.com/mgx/img/favicon_atoms.ico" />
    <meta property="og:url" id="ogUrl" content="https://tronghuynh888.github.io/MovieChain/" />
    <!-- Th·∫ª Twitter Card cho t∆∞∆°ng th√≠ch ph·ª• -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" id="twTitle" content="Tr·∫°m Phim - R·∫°p Chi·∫øu Phim Blockchain">
    <meta name="twitter:description" id="twDescription" content="R·∫°p Chi·∫øu Phim Blockchain - Xem phim tr·ª±c tuy·∫øn, thanh to√°n b·∫±ng CRO Token">
    <meta name="twitter:image" id="twImage" content="https://public-frontend-cos.metadl.com/mgx/img/favicon_atoms.ico">

    <!-- Favicon -->
    <link
      rel="icon"
      href="https://public-frontend-cos.metadl.com/mgx/img/favicon_atoms.ico"
      type="image/x-icon"
    />

    <!-- Montserrat Font -->
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&display=swap"
      rel="stylesheet"
    />

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700&family=Rajdhani:wght@400;500;600;700&family=Roboto:wght@300;400;500;700&display=swap"
      rel="stylesheet"
    />

    <!-- Font Awesome Icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <!-- HLS.js for Streaming -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

    <!-- Custom CSS -->
  </head>
  <body>
    <!-- ============================================
         NAVIGATION BAR
         ============================================ -->
    <nav class="navbar" id="navbar">
      <div class="nav-container">
        <button
          id="sidebarToggleBtn"
          class="btn-icon"
          onclick="toggleSidebar()"
          style="
            display: none;
            margin-right: 15px;
            background: transparent;
            border: none;
            color: var(--text-primary);
            cursor: pointer;
          "
        >
          <i class="fas fa-bars" style="font-size: 24px"></i>
        </button>

        <!-- Logo -->
        <a href="javascript:void(0)" class="nav-logo" onclick="showPage('home')">
          <img src="images/logoTramPhim.png" alt="Tr·∫°m Phim" class="logo-img" />
        </a>

        <!-- Navigation Menu -->
        <div class="nav-menu" id="navMenu">
          <a
            href="javascript:void(0)"
            class="nav-link active"
            data-page="home"
            onclick="showPage('home')"
          >
            <i class="fas fa-home"></i> Trang Ch·ªß
          </a>

          <a
            href="javascript:void(0)"
            class="nav-link"
            data-page="movies"
            onclick="showPage('movies')"
          >
            <i class="fas fa-film"></i> T·∫•t c·∫£ Phim
          </a>

          <a href="javascript:void(0)" class="nav-link" data-page="singleMovies" onclick="showPage('singleMovies')">
            <i class="fas fa-video"></i> Phim L·∫ª
          </a>
          <a href="javascript:void(0)" class="nav-link" data-page="seriesMovies" onclick="showPage('seriesMovies')">
            <i class="fas fa-layer-group"></i> Phim B·ªô
          </a>
          <a
            href="javascript:void(0)"
            class="nav-link"
            data-page="categories"
            onclick="showPage('categories')"
          >
            <i class="fas fa-tags"></i> Th·ªÉ Lo·∫°i
          </a>
          <!-- Admin Link - Ch·ªâ hi·ªán khi l√† Admin -->
          <a
            href="javascript:void(0)"
            class="nav-link hidden"
            id="adminNavLink"
            data-page="admin"
            onclick="showPage('admin')"
          >
            <i class="fas fa-cog"></i> Admin
          </a>
        </div>

        <!-- Theme + Wallet (nh√≥m ph·ª• - n·∫±m gi·ªØa menu v√† auth) -->
        <div class="nav-utilities" style="display: flex; align-items: center;">
          <!-- Notification Bell Wrapper -->
          <div class="notification-wrapper">
            <button
              class="notification-btn"
              id="notificationBtn"
              title="Th√¥ng b√°o"
              onclick="toggleNotificationDropdown(event)"
            >
              <i class="fas fa-bell" style="font-size: 20px; pointer-events: none;"></i>
              <span id="notificationBadge" class="notification-badge">0</span>
            </button>
            
            <!-- Notification Dropdown -->
            <div id="notificationDropdown" class="notification-dropdown hidden">
              <div class="notification-dropdown-header">
                  <strong><i class="fas fa-bell text-info"></i> Th√¥ng b√°o</strong>
                  <button onclick="markAllAsRead()" class="btn-mark-read">ƒê√°nh d·∫•u ƒë√£ ƒë·ªçc</button>
              </div>
              <ul class="dropdown-list" id="notificationList" style="padding: 0; margin: 0; list-style: none; overflow-y: auto; flex-grow: 1;">
                  <li style="padding: 15px; text-align: center; color: var(--text-muted);">ƒêang t·∫£i th√¥ng b√°o...</li>
              </ul>
              <div class="notification-dropdown-footer">
                  <button onclick="deleteAllNotifications()" class="btn-delete-all"><i class="fas fa-trash-alt"></i> X√≥a t·∫•t c·∫£</button>
              </div>
            </div>
          </div>

          <!-- Theme Toggle -->
          <button
            class="theme-toggle"
            id="themeToggle"
            onclick="toggleTheme()"
            title="ƒê·ªïi giao di·ªán"
            style="margin-right: 10px;"
          >
            <i class="fas fa-moon" id="themeIcon"></i>
          </button>

          <!-- Wallet Button -->
          <button
            class="btn wallet-btn"
            id="walletBtn"
            onclick="connectWallet()"
            style="margin-right: 10px;"
          >
            <i class="fas fa-wallet"></i>
            <span class="wallet-btn-text">K·∫øt n·ªëi v√≠</span>
          </button>

          <!-- Auth Button (ngay sau Wallet) -->
          <div id="authContainer" style="position: relative; display: flex; align-items: center; flex-shrink: 0; margin-left: 2px;">
            <button
              class="btn btn-primary hidden"
              id="loginBtn"
              onclick="openAuthModal()"
              style="white-space: nowrap; flex-shrink: 0; min-width: fit-content; padding: 10px 24px; border-radius: 8px; display: flex; align-items: center; gap: 8px;"
            >
              <i class="fas fa-user"></i> <span>ƒêƒÉng nh·∫≠p / ƒêƒÉng k√Ω</span>
            </button>

            <div
              id="userMenuTrigger"
              class="hidden"
              onclick="toggleUserDropdown(event)"
              style="cursor: pointer; margin-left: 30px; position: static;"
            >
              <img id="userAvatarSmall" src="" class="nav-user-avatar" />
            </div>

            <div id="userDropdown" class="user-dropdown">
              <div class="dropdown-header">
                <img id="dropdownAvatar" src="" alt="Avatar" />
                <div class="dropdown-user-info">
                  <span class="dropdown-role">Free</span>
                  <strong id="dropdownName">T√™n User</strong>
                </div>
              </div>

              <div class="dropdown-upgrade">
                <p>
                  N√¢ng c·∫•p t√†i kho·∫£n Tr·∫°m Phim ƒë·ªÉ c√≥ tr·∫£i nghi·ªám ƒë·∫≥ng c·∫•p h∆°n.
                </p>
                <button class="btn-upgrade" onclick="showPage('upgrade')">
                  N√¢ng c·∫•p ngay <i class="fas fa-arrow-up"></i>
                </button>
              </div>

              <ul class="dropdown-list">
                <li class="dropdown-item">
                  <i class="fas fa-wallet"></i>
                  <span>S·ªë d∆∞</span>
                  <span class="balance-badge">0 C</span>
                  <button class="btn-deposit" onclick="showPage('upgrade')">
                    + N·∫°p
                  </button>
                </li>
                <li
                  class="dropdown-item"
                  onclick="openLibraryModal('favorites')"
                >
                  <i class="fas fa-heart"></i> Y√™u th√≠ch
                </li>
                <li class="dropdown-item" onclick="openLibraryModal('history')">
                  <i class="fas fa-history"></i> Xem ti·∫øp
                </li>
                <li class="dropdown-item" onclick="openMyAlbumsModal()">
                  <i class="fas fa-folder-open"></i> Album c·ªßa t√¥i
                </li>
                <li class="dropdown-item" onclick="openProfileModal()">
                  <i class="fas fa-user-cog"></i> T√†i kho·∫£n
                </li>
                <li class="dropdown-item logout" onclick="handleLogout()">
                  <i class="fas fa-sign-out-alt"></i> Tho√°t
                </li>
              </ul>
            </div>
          </div>
        </div>

        <!-- Mobile Menu Toggle -->
        <div class="nav-actions">
          <button
            class="mobile-menu-toggle"
            id="mobileMenuToggle"
            onclick="toggleMobileMenu()"
          >
            <i class="fas fa-bars"></i>
          </button>
        </div>
      </div>
    </nav>

    <!-- ============================================
         MAIN CONTENT
         ============================================ -->
    <main id="mainContent">
      <!-- HOME PAGE -->
      <div id="homePage" class="page active">
        <!-- Banner Slider Section -->
        <section class="hero-banner" id="heroBanner">
          <div class="banner-track" id="bannerTrack">
            <!-- C√°c slide ƒë∆∞·ª£c render b·ªüi banner-slider.js -->
          </div>
          <!-- N√∫t ƒëi·ªÅu h∆∞·ªõng tr√°i/ph·∫£i -->
          <button class="banner-nav banner-prev" id="bannerPrev" aria-label="Slide tr∆∞·ªõc">
            <i class="fas fa-chevron-left"></i>
          </button>
          <button class="banner-nav banner-next" id="bannerNext" aria-label="Slide ti·∫øp">
            <i class="fas fa-chevron-right"></i>
          </button>
          <!-- Dot indicators -->
          <div class="banner-dots" id="bannerDots"></div>
          <!-- Thumbnail preview (g√≥c ph·∫£i d∆∞·ªõi) -->
          <div class="banner-thumbs" id="bannerThumbs"></div>
        </section>

        <!-- Featured Movies Section -->
        <section class="section">
          <div class="section-header">
            <h2 class="section-title">Phim N·ªïi B·∫≠t</h2>
            <a href="javascript:void(0)" class="btn btn-secondary" onclick="showPage('movies')">
              Xem t·∫•t c·∫£ <i class="fas fa-arrow-right"></i>
            </a>
          </div>
          <div class="movie-grid" id="featuredMovies">
            <!-- Movies s·∫Ω ƒë∆∞·ª£c load t·ª´ Firestore -->
            <div class="skeleton" style="height: 350px"></div>
            <div class="skeleton" style="height: 350px"></div>
            <div class="skeleton" style="height: 350px"></div>
            <div class="skeleton" style="height: 350px"></div>
          </div>
        </section>

        <!-- New Movies Section -->
        <section class="section">
          <div class="section-header">
            <h2 class="section-title">Phim M·ªõi C·∫≠p Nh·∫≠t</h2>
          </div>
          <div class="movie-grid" id="newMovies">
            <!-- Movies s·∫Ω ƒë∆∞·ª£c load t·ª´ Firestore -->
          </div>
        </section>

        <!-- Country Sections (H√†n Qu·ªëc, Trung Qu·ªëc, US-UK) -->
        <div id="countrySections"></div>
      </div>

      <!-- MOVIES PAGE -->
      <div id="moviesPage" class="page">
        <section class="section">
          <div class="section-header">
            <h2 class="section-title">T·∫•t C·∫£ Phim</h2>
            <div class="search-filter">
              <div class="search-box">
                <i class="fas fa-search"></i>
                <input
                  type="text"
                  class="form-input"
                  id="searchMovies"
                  placeholder="T√¨m ki·∫øm phim..."
                  oninput="searchMovies()"
                />
              </div>
              <select
                class="form-select"
                id="filterCategory"
                onchange="filterMovies()"
              >
                <option value="">T·∫•t c·∫£ th·ªÉ lo·∫°i</option>
              </select>
              <select
                class="form-select"
                id="filterCountry"
                onchange="filterMovies()"
              >
                <option value="">T·∫•t c·∫£ qu·ªëc gia</option>
              </select>
              <select
                class="form-select"
                id="filterYear"
                onchange="filterMovies()"
              >
                <option value="">T·∫•t c·∫£ nƒÉm</option>
              </select>
            </div>
          </div>
          <div class="movie-grid" id="allMoviesGrid">
            <!-- Movies s·∫Ω ƒë∆∞·ª£c load t·ª´ Firestore -->
          </div>
        </section>
      </div>

      <!-- SERIES MOVIES PAGE (SPA) -->
      <div id="seriesMoviesPage" class="page"></div>

      <!-- SINGLE MOVIES PAGE (SPA) -->
      <div id="singleMoviesPage" class="page"></div>

      <!-- CATEGORIES PAGE -->
      <div id="categoriesPage" class="page">
        <section class="section">
          <div class="section-header">
            <h2 class="section-title">Th·ªÉ Lo·∫°i Phim</h2>
          </div>
          <div
            class="movie-grid"
            id="categoriesList"
            style="grid-template-columns: repeat(auto-fill, minmax(250px, 1fr))"
          >
            <!-- Categories s·∫Ω ƒë∆∞·ª£c load t·ª´ Firestore -->
          </div>
        </section>
      </div>

      <!-- MOVIE INTRO PAGE (Load dynamic) -->
      <div id="movieIntroPage" class="page"></div>

      <!-- MOVIE DETAIL PAGE -->
      <div id="movieDetailPage" class="page movie-detail-redesign">
        <!-- TOP BAR: Back + Title -->
        <div class="detail-top-bar">
            <button class="btn-back-square" onclick="goBackFromDetail()">
              <i class="fas fa-chevron-left"></i>
            </button>
            <span class="detail-page-title" id="redesignTopTitle">Xem phim ...</span>
          </div>

          <!-- PLAYER SECTION -->
          <div class="player-section">
            <div class="video-container" id="videoContainer">
              <div class="video-locked" id="videoLocked">
                <div class="video-locked-bg"></div>
                <div class="video-locked-content">
                  <div class="lock-icon-wrapper">
                    <i class="fas fa-lock"></i>
                  </div>
                  <div class="locked-info">
                    <span class="locked-badge"> PREMIUM</span>
                    <h3>Phim Tr·∫£ Ph√≠</h3>
                    <p class="movie-title" id="lockedMovieTitle">T√™n phim</p>
                    <p class="unlock-text">
                      Mua v√© ƒë·ªÉ m·ªü kh√≥a v√† th∆∞·ªüng th·ª©c phim ch·∫•t l∆∞·ª£ng cao v·ªõi gi√° ch·ªâ t·ª´ <span class="price-highlight" id="lockedPrice">...</span>
                    </p>
                  </div>
                  <button class="btn btn-unlock btn-lg" onclick="buyTicket()">
                    <i class="fas fa-unlock"></i> <span>Mua V√© Ngay</span>
                  </button>
                  <p class="secure-text">
                    <i class="fas fa-shield-alt"></i> Thanh to√°n an to√†n b·∫±ng CRO Token
                  </p>
                </div>
              </div>
              
              <iframe id="videoPlayer" class="hidden" src="" allowfullscreen></iframe>
              <video id="html5Player" class="hidden" playsinline></video>
              
              <!-- TOP INFO BAR (T√™n phim + Danh s√°ch t·∫≠p) - ch·ªâ hi·ªán khi fullscreen -->
              <div class="player-top-bar" id="playerTopBar">
                <div class="top-bar-left">
                  <span class="top-bar-title" id="topBarTitle">ƒêang t·∫£i...</span>
                  <span class="top-bar-episode" id="topBarEpisode"></span>
                </div>
                <div class="top-bar-right">
                  <button class="top-bar-btn" id="episodeListBtn" onclick="toggleEpisodePanel(); event.stopPropagation();">
                    <i class="fas fa-list-ul"></i> <span>Danh s√°ch t·∫≠p</span>
                  </button>
                </div>
              </div>

              <!-- Center Controls -->
              <div class="center-controls-overlay" id="centerOverlay">
                <button class="center-btn skip-btn" onclick="skipTime(-10); event.stopPropagation();">
                  <svg viewBox="0 0 24 24" fill="none" class="skip-svg" stroke="currentColor" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg><span class="skip-label">10</span>
                </button>
                <button class="center-btn play-btn-large" onclick="togglePlay(); event.stopPropagation();">
                  <i class="fas fa-play" id="centerPlayIcon"></i>
                </button>
                <button class="center-btn skip-btn" onclick="skipTime(10); event.stopPropagation();">
                  <svg viewBox="0 0 24 24" fill="none" class="skip-svg" stroke="currentColor" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12a9 9 0 1 1-9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/></svg><span class="skip-label">10</span>
                </button>
              </div>

              <!-- CUSTOM VIDEO CONTROLS -->
              <div class="custom-video-controls hidden" id="customControls">
                <!-- Th·ªùi gian hi·ªán t·∫°i (g√≥c tr√°i) + T·ªïng (g√≥c ph·∫£i) - ngang h√†ng progress -->
                <div class="time-row">
                  <span class="time-current" id="currentTime">00:00</span>
                  <span class="time-duration" id="duration">00:00</span>
                </div>
                <div class="progress-tooltip" id="progressTooltip">00:00</div>
                <div class="video-progress-container" id="progressContainer">
                  <div class="video-progress-filled" id="progressBar"></div>
                  <div class="video-progress-buffer" id="bufferBar"></div>
                  <input type="range" class="video-progress-slider" id="progressSlider" min="0" max="100" value="0" step="0.1">
                </div>
                <div class="video-controls-row">
                  <div class="controls-left">
                    <button class="control-btn" id="playPauseBtn" onclick="togglePlay()">
                      <i class="fas fa-play"></i>
                    </button>
                    <button class="control-btn skip-btn-small" onclick="skipTime(-10)" title="L√πi 10s">
                      <svg viewBox="0 0 24 24" fill="none" class="skip-svg" stroke="currentColor" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg><span class="skip-label">10</span>
                    </button>
                    <button class="control-btn skip-btn-small" onclick="skipTime(10)" title="T·ªõi 10s">
                      <svg viewBox="0 0 24 24" fill="none" class="skip-svg" stroke="currentColor" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12a9 9 0 1 1-9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/></svg><span class="skip-label">10</span>
                    </button>
                    <div class="volume-container">
                      <button class="control-btn" id="volumeBtn" onclick="toggleMute()">
                        <i class="fas fa-volume-up"></i>
                      </button>
                      <div class="volume-slider-wrapper">
                        <input type="range" class="volume-slider" id="volumeSlider" min="0" max="1" step="0.05" value="1">
                      </div>
                    </div>
                  </div>
                  <div class="controls-right">
                    <div class="settings-container">
                      <button class="control-btn" id="settingsBtn" onclick="toggleSettingsMenu()">
                        <i class="fas fa-cog"></i>
                      </button>
                      <div class="settings-menu" id="settingsMenu">
                        <div class="settings-item" onclick="showSubMenu('speed')">
                          <span>T·ªëc ƒë·ªô</span>
                          <span class="settings-value" id="currentSpeedVal">Chu·∫©n</span>
                          <i class="fas fa-chevron-right"></i>
                        </div>
                        <div class="settings-item" onclick="showSubMenu('color')">
                          <span>M√†u ph·ª• ƒë·ªÅ</span>
                          <span class="settings-value" id="currentColorVal">White</span>
                          <i class="fas fa-chevron-right"></i>
                        </div>
                        <div class="settings-item" id="qualitySettingsItem" onclick="showSubMenu('quality')" style="display:none;">
                          <span>Ch·∫•t l∆∞·ª£ng</span>
                          <span class="settings-value" id="currentQualityVal">T·ª± ƒë·ªông</span>
                          <i class="fas fa-chevron-right"></i>
                        </div>
                      </div>
                      <div class="settings-submenu" id="speedMenu">
                        <div class="submenu-header" onclick="hideSubMenu()">
                          <i class="fas fa-chevron-left"></i> T·ªëc ƒë·ªô ph√°t
                        </div>
                        <div class="submenu-item" onclick="setSpeed(0.5)">0.5x</div>
                        <div class="submenu-item" onclick="setSpeed(0.75)">0.75x</div>
                        <div class="submenu-item active" onclick="setSpeed(1)">Chu·∫©n</div>
                        <div class="submenu-item" onclick="setSpeed(1.25)">1.25x</div>
                        <div class="submenu-item" onclick="setSpeed(1.5)">1.5x</div>
                        <div class="submenu-item" onclick="setSpeed(2)">2x</div>
                      </div>
                      <div class="settings-submenu" id="colorMenu">
                        <div class="submenu-header" onclick="hideSubMenu()">
                          <i class="fas fa-chevron-left"></i> M√†u ph·ª• ƒë·ªÅ
                        </div>
                        <div class="submenu-item active" data-color="white" onclick="setSubtitleColor('white')">TR·∫ÆNG</div>
                        <div class="submenu-item" data-color="yellow" onclick="setSubtitleColor('yellow')" style="color: yellow;">V√ÄNG</div>
                        <div class="submenu-item" data-color="cyan" onclick="setSubtitleColor('cyan')" style="color: cyan;">XANH D∆Ø∆†NG</div>
                        <div class="submenu-item" data-color="green" onclick="setSubtitleColor('green')" style="color: #4caf50;">XANH L√Å</div>
                      </div>
                      <div class="settings-submenu" id="qualityMenu">
                        <div class="submenu-header" onclick="hideSubMenu()">
                          <i class="fas fa-chevron-left"></i> Ch·∫•t l∆∞·ª£ng video
                        </div>
                        <div class="submenu-item active" data-level="-1" onclick="setQuality(-1)">T·ª± ƒë·ªông</div>
                      </div>
                    </div>
                    <button class="control-btn" id="pipBtn" onclick="togglePiP()" title="H√¨nh trong h√¨nh">
                      <i class="fas fa-external-link-alt"></i>
                    </button>
                    <button class="control-btn" id="fullscreenBtn" onclick="toggleFullscreen()">
                      <i class="fas fa-expand"></i>
                    </button>
                  </div>
                </div>
              </div>

              <!-- EPISODE PANEL (Slide-in t·ª´ ph·∫£i khi b·∫•m Danh s√°ch t·∫≠p) -->
              <div class="player-episode-panel" id="playerEpisodePanel">
                <div class="episode-panel-header">
                  <h4>Danh s√°ch t·∫≠p</h4>
                  <button class="episode-panel-close" onclick="toggleEpisodePanel()">
                    <i class="fas fa-times"></i>
                  </button>
                </div>
                <div class="episode-panel-list" id="episodePanelList">
                  <!-- JS s·∫Ω render danh s√°ch t·∫≠p v√†o ƒë√¢y -->
                </div>
              </div>
            </div> <!-- End video-container -->

            <!-- REACTION SIDEBAR (Vertical Floating) - Outside video-container -->
            <div class="reaction-sidebar hidden" id="reactionSidebar">
              <span class="reaction-btn" onclick="if(window.sendReaction) { sendReaction('‚ù§Ô∏è'); event.stopPropagation(); }">‚ù§Ô∏è</span>
              <span class="reaction-btn" onclick="if(window.sendReaction) { sendReaction('üòÇ'); event.stopPropagation(); }">üòÇ</span>
              <span class="reaction-btn" onclick="if(window.sendReaction) { sendReaction('üòÆ'); event.stopPropagation(); }">üòÆ</span>
              <span class="reaction-btn" onclick="if(window.sendReaction) { sendReaction('üò¢'); event.stopPropagation(); }">üò¢</span>
              <span class="reaction-btn" onclick="if(window.sendReaction) { sendReaction('üî•'); event.stopPropagation(); }">üî•</span>
              <span class="reaction-btn" onclick="if(window.sendReaction) { sendReaction('üí©'); event.stopPropagation(); }">üí©</span>
            </div>
          </div> <!-- End player-section -->

          <!-- BOTTOM TOOLBAR -->
          <div class="detail-toolbar">
            <div class="toolbar-group">
                <button class="btn-toolbar" id="btnLikeDetail" onclick="toggleFavorite()">
                    <i class="far fa-heart"></i> Y√™u th√≠ch
                </button>
                <button class="btn-toolbar" id="btnAddAlbum" onclick="openAlbumModal()">
                    <i class="fas fa-plus"></i> Th√™m v√†o
                </button>
            </div>

            <div class="toolbar-group">
                <div class="switch-item">
                    <span>Chuy·ªÉn t·∫≠p</span>
                    <span class="badge-switch on" id="swNextEpisode" onclick="toggleSwitch('swNextEpisode')">ON</span>
                </div>
                <div class="switch-item">
                    <span>R·∫°p phim</span>
                    <span class="badge-switch off" id="swCinemaMode" onclick="toggleSwitch('swCinemaMode')">OFF</span>
                </div>
                <div class="switch-item">
                    <span>Anti L√™</span>
                    <span class="badge-switch on" id="swAntiLe" onclick="toggleSwitch('swAntiLe')">ON</span>
                </div>
                <button class="btn-toolbar" onclick="shareMovie()">
                    <i class="fas fa-paper-plane"></i> Chia s·∫ª
                </button>
                <button class="btn-toolbar" onclick="startWatchParty()">
                    <i class="fas fa-users"></i> Xem chung
                </button>
                <div class="switch-item">
                    <span>L·∫° ƒë·ªùi</span>
                    <span class="badge-switch off" id="swStrange" onclick="toggleSwitch('swStrange')">OFF</span>
                </div>
                <div class="switch-item">
                    <span>Reaction</span>
                    <span class="badge-switch off" id="swReaction" onclick="toggleSwitch('swReaction')">OFF</span>
                </div>
            </div>

            <div class="toolbar-group">
                <button class="btn-toolbar btn-report" onclick="reportError()">
                    <i class="fas fa-flag"></i> B√°o l·ªói
                </button>
            </div>
          </div>
          
          <!-- MOVIE INFO REDESIGN (ThiaPhim style) -->
          <div class="movie-info-redesign container mt-4">
            <div class="info-layout">
                <!-- Poster b√™n tr√°i -->
                <div class="info-poster-wrapper">
                    <img id="detailPoster" src="" alt="Poster" class="info-poster">
                    <div class="info-price-tag hidden" id="purchasePriceTag">
                        <i class="fab fa-ethereum"></i> <span id="croPriceValue">...</span> CRO
                    </div>
                </div>

                <!-- N·ªôi dung th√¥ng tin b√™n ph·∫£i -->
                <div class="info-content-wrapper">
                    <h1 class="info-title" id="detailTitle">...</h1>
                    <p id="detailOriginTitle" style="font-size: 1.05em; color: #555; margin: 0 0 10px; font-style: italic; display: none; font-weight: 500;"></p>
                    <div class="info-meta">
                        <span class="meta-item year" id="detailYear">...</span>
                        <span class="meta-item country" id="detailCountry">...</span>
                        <span class="meta-item rating"><i class="fas fa-star text-warning"></i> <span id="detailRating">...</span></span>
                        <span class="meta-item views"><i class="fas fa-eye"></i> <span id="detailViews">...</span></span>
                    </div>
                    
                    <div class="info-categories" id="detailCategory">...</div>

                    <div class="info-description-box">
                        <p class="info-description-short" id="detailDescription">...</p>
                        <a href="#" class="info-link" onclick="event.preventDefault(); viewMovieIntro(currentMovieId)">Th√¥ng tin phim <i class="fas fa-chevron-right"></i></a>
                    </div>

                    <!-- N√∫t thanh to√°n (Ch·ªâ hi·ªán khi phim tr·∫£ ph√≠) -->
                    <div class="info-payment-action hidden" id="paymentActionBox">
                        <button class="btn-buy-ticket" id="buyTicketBtn" onclick="buyTicket()">
                            <i class="fas fa-ticket-alt"></i> Mua V√© Xem Phim (<span id="btnCroPrice">...</span> CRO)
                        </button>
                        <p class="payment-hint"><i class="fas fa-info-circle"></i> Thanh to√°n b·∫±ng v√≠ MetaMask qua m·∫°ng Cronos</p>
                    </div>
                </div>
            </div>
          </div>

          <!-- Version Selection (New) -->
          <div class="container" id="versionContainer" style="margin-top: 20px; display: none;">
              <h4 class="text-white mb-2" style="font-size: 1rem; opacity: 0.8;">Phi√™n b·∫£n:</h4>
              <div id="versionList" style="display: flex; gap: 10px; flex-wrap: wrap;"></div>
          </div>

          <!-- Related Parts (New) -->
          <div class="container" id="relatedPartsContainer" style="margin-top: 15px; display: none;">
              <h4 class="text-white mb-2" style="font-size: 1rem; opacity: 0.8;">Ph·∫ßn phim li√™n quan:</h4>
              <div id="relatedPartsList" style="display: flex; gap: 10px; overflow-x: auto; padding-bottom: 5px;"></div>
          </div>

          <!-- Episodes Section -->
          <div class="episodes-section" id="episodesSection">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <h3 class="section-title" style="margin-bottom: 0;">Danh S√°ch T·∫≠p</h3>
                <!-- Pagination Dropdown -->
                <select id="episodePageSelect" class="form-select bg-dark text-white border-secondary" style="width: auto; max-width: 200px; display: none;" onchange="changeEpisodePage(this.value)">
                    <!-- Options generated by JS -->
                </select>
            </div>
            
            <div class="episodes-list" id="episodesList">
              <!-- Episodes s·∫Ω ƒë∆∞·ª£c load ƒë·ªông -->
            </div>
          </div>

          <!-- Comments Section -->
          <div class="comments-section">
            <h3 class="section-title">B√¨nh Lu·∫≠n & ƒê√°nh Gi√°</h3>

            <!-- Comment Form -->
            <div class="comment-form" id="commentForm">
              <div class="rating-input">
                <label>ƒê√°nh gi√° c·ªßa b·∫°n:</label>
                <div class="rating-stars" id="ratingStars">
                  <!-- Stars s·∫Ω ƒë∆∞·ª£c t·∫°o b·∫±ng JS -->
                </div>
                <span class="rating-value" id="ratingValue">0/10</span>
              </div>
              <div class="form-group">
                <textarea
                  class="form-textarea"
                  id="commentContent"
                  placeholder="Vi·∫øt b√¨nh lu·∫≠n c·ªßa b·∫°n..."
                ></textarea>
              </div>
              <button class="btn btn-primary" onclick="submitComment()">
                <i class="fas fa-paper-plane"></i> G·ª≠i B√¨nh Lu·∫≠n
              </button>
            </div>

            <!-- Comments List -->
            <div class="comments-list" id="commentsList">
              <!-- Comments s·∫Ω ƒë∆∞·ª£c load t·ª´ Firestore -->
            </div>
          </div>
      </div>
      <div id="modals-container"></div>
      <div id="admin-container"></div>
    </main>

    <!-- ============================================
         FOOTER
         ============================================ -->
    <footer class="footer" id="footer">
      <div class="footer-content">
        <div class="footer-section">
          <h4><i class="fas fa-film"></i> Tr·∫°m Phim</h4>
          <p class="text-muted">
            N·ªÅn t·∫£ng xem phim Blockchain. Thanh to√°n an to√†n, minh b·∫°ch b·∫±ng
            CRO.
          </p>
          <div class="social-links">
            <a href="javascript:void(0)"><i class="fab fa-facebook-f"></i></a>
            <a href="javascript:void(0)"><i class="fab fa-telegram-plane"></i></a>
            <a href="javascript:void(0)"><i class="fab fa-discord"></i></a>
          </div>
        </div>

        <div class="footer-section">
          <h4>Kh√°m Ph√°</h4>
          <ul>
            <li><a href="javascript:void(0)" onclick="showPage('movies')">Kho Phim</a></li>
            <li><a href="javascript:void(0)" onclick="showPage('categories')">Th·ªÉ Lo·∫°i</a></li>
            <li><a href="javascript:void(0)" onclick="showPage('upgrade')">G√≥i VIP</a></li>
          </ul>
        </div>

        <div class="footer-section">
          <h4>H·ªó Tr·ª£</h4>
          <ul>
            <li><a href="javascript:void(0)">ƒêi·ªÅu kho·∫£n</a></li>
            <li><a href="javascript:void(0)">B·∫£o m·∫≠t</a></li>
            <li><a href="javascript:void(0)">Li√™n h·ªá Admin</a></li>
          </ul>
        </div>

        <div class="footer-section stats-box">
          <h4><i class="fas fa-chart-line"></i> Th·ªëng K√™</h4>

          <div class="live-stat-item">
            <span class="stat-label"
              ><i class="fas fa-users"></i> ƒêang Online:</span
            >
            <span class="stat-value highlight" id="statOnline">--</span>
          </div>

          <div class="live-stat-item">
            <span class="stat-label"
              ><i class="fas fa-globe"></i> T·ªïng truy c·∫≠p:</span
            >
            <span class="stat-value" id="statVisits">--</span>
          </div>

          <div class="live-stat-item">
            <span class="stat-label"
              ><i class="fas fa-clock"></i> TG trung b√¨nh:</span
            >
            <span class="stat-value" id="statTime">--</span>
          </div>
        </div>
      </div>

      <div class="footer-bottom">
        <p>&copy; 2026 Tr·∫°m Phim. Powered by Blockchain Technology.</p>
      </div>
    </footer>
    <div id="modals-container"></div>

    <!-- PeerJS for WebRTC -->
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <!-- ============================================
         SCRIPTS

         
         ============================================ -->
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <!-- Ethers.js for Web3 -->
    <script src="https://cdn.ethers.io/lib/ethers-5.7.2.umd.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
    <!-- Firebase Config -->
    <script src="js/firebase-config.js"></script>
    <script src="js/web3-config.js"></script>

    <script src="js/globals.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/data.js"></script>

    <script src="js/auth.js"></script>
    <script src="js/notifications.js"></script>
    <script src="js/user.js"></script>
    <script src="js/home.js"></script>
    <script src="js/detail.js"></script>
    <script src="js/admin.js"></script>

    <script src="js/upgrade.js"></script>
    <script src="js/intro.js"></script>
    <script src="js/watch-party.js"></script>
    <script src="js/series-movies.js"></script>
    <script src="js/single-movies.js"></script>
    <script src="js/banner-slider.js"></script>

    <script src="js/main.js"></script>
    <script src="js/loader.js"></script>
    <!-- YouTube IFrame API -->
    <script src="https://www.youtube.com/iframe_api"></script>
    
    <script>
      // Bu·ªôc tr√¨nh duy·ªát ph·∫£i d√πng h√†m n√†y (Ghi ƒë√® m·ªçi h√†m c≈© b·ªã l·ªói)
      window.showAdminPanel = function (panelName) {
        console.log("üñ±Ô∏è ƒêang chuy·ªÉn sang tab:", panelName);

        // 1. ·∫®n t·∫•t c·∫£ c√°c trang con
        var allPanels = document.querySelectorAll(".admin-panel");
        allPanels.forEach(function (panel) {
          panel.classList.remove("active");
        });

        // 2. Hi·ªán trang c·∫ßn ch·ªçn
        var targetId = panelName + "Panel"; // V√≠ d·ª•: dashboardPanel
        var targetPanel = document.getElementById(targetId);

        if (targetPanel) {
          targetPanel.classList.add("active");
        } else {
          console.error("‚ùå Kh√¥ng t√¨m th·∫•y trang c√≥ ID l√†: " + targetId);
          // N·∫øu kh√¥ng t√¨m th·∫•y panel, th·ª≠ hi·ªán th√¥ng b√°o ƒë·ªÉ ki·ªÉm tra
          // alert("L·ªói: Kh√¥ng t√¨m th·∫•y giao di·ªán " + panelName);
        }

        // 3. ƒê·ªïi m√†u menu b√™n tr√°i (Active)
        var allNavItems = document.querySelectorAll(".admin-nav-item");
        allNavItems.forEach(function (item) {
          item.classList.remove("active");
          // Ki·ªÉm tra xem n√∫t n√†y c√≥ ph·∫£i l√† n√∫t v·ª´a b·∫•m kh√¥ng
          if (
            item.getAttribute("onclick") &&
            item.getAttribute("onclick").includes(panelName)
          ) {
            item.classList.add("active");
          }
        });

        // T·ª± ƒë·ªông t·∫£i d·ªØ li·ªáu n·∫øu chuy·ªÉn sang tab c·ª• th·ªÉ
        if (panelName === "errorReports" && typeof loadErrorReports === "function") {
            loadErrorReports();
        }

        // 4. [NEW] T·ª± ƒë·ªông ƒë√≥ng menu tr√™n Mobile sau khi ch·ªçn
        if (window.innerWidth <= 768) {
             var sidebar = document.querySelector(".admin-sidebar");
             if (sidebar && sidebar.classList.contains("active")) {
                 toggleSidebar(); // G·ªçi h√†m ƒë√≥ng menu
             }
        }
      };
    </script>
    <script>
      // H√†m load file HTML b√™n ngo√†i v√†o trang ch√≠nh
      async function loadUpgradePage() {
        try {
          // T·∫£i file upgrade.html
          const response = await fetch("./components/upgrade.html");
          const html = await response.text();

          // Ch√®n v√†o cu·ªëi th·∫ª <main>
          document
            .getElementById("mainContent")
            .insertAdjacentHTML("beforeend", html);
          console.log("‚úÖ ƒê√£ t·∫£i giao di·ªán Upgrade th√†nh c√¥ng!");
        } catch (error) {
          console.error("L·ªói t·∫£i trang Upgrade:", error);
        }
      }

      // G·ªçi h√†m ch·∫°y ngay khi web m·ªü
      loadUpgradePage();
    </script>
    
    <!-- Resume Watch Modal -->
    <div class="modal-overlay" id="resumeWatchModal">
        <div class="modal resume-watch-modal">
            <div class="modal-header">
                <h3><i class="fas fa-play-circle"></i> Ti·∫øp T·ª•c Xem Phim</h3>
            </div>
            <div class="modal-body">
                <p id="resumeWatchMessage">B·∫°n c√≥ mu·ªën ti·∫øp t·ª•c xem phim t·ª´ v·ªã tr√≠ ƒë√£ d·ª´ng kh√¥ng?</p>
                <div class="resume-info">
                    <span class="resume-time-label">Th·ªùi gian ƒë√£ xem:</span>
                    <span class="resume-time-value" id="resumeWatchTime">--:--</span>
                </div>
                <div class="resume-info">
                    <span class="resume-progress-label">Ti·∫øn tr√¨nh:</span>
                    <span class="resume-progress-value" id="resumeWatchPercent">0%</span>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="resumeFromStartBtn" onclick="handleResumeChoice(false)">
                    <i class="fas fa-redo"></i> Xem T·ª´ ƒê·∫ßu
                </button>
                <button class="btn btn-primary" id="resumeContinueBtn" onclick="handleResumeChoice(true)">
                    <i class="fas fa-play"></i> Ti·∫øp T·ª•c
                </button>
            </div>
        </div>
    </div>
  </body>
</html>
